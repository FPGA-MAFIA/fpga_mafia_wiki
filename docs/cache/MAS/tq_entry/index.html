<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-cache/MAS/tq_entry" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.3">
<title data-rh="true">tq_entry | FPGA Multi-Agent FabrIc Architecture </title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://fpga-mafia.github.io /fpga_mafia_wiki/docs/cache/MAS/tq_entry"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="tq_entry | FPGA Multi-Agent FabrIc Architecture "><meta data-rh="true" name="description" content="The transaction queue entry Micro-Architecture-Specification"><meta data-rh="true" property="og:description" content="The transaction queue entry Micro-Architecture-Specification"><link data-rh="true" rel="icon" href="/fpga_mafia_wiki/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://fpga-mafia.github.io /fpga_mafia_wiki/docs/cache/MAS/tq_entry"><link data-rh="true" rel="alternate" href="https://fpga-mafia.github.io /fpga_mafia_wiki/docs/cache/MAS/tq_entry" hreflang="en"><link data-rh="true" rel="alternate" href="https://fpga-mafia.github.io /fpga_mafia_wiki/docs/cache/MAS/tq_entry" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/fpga_mafia_wiki/blog/rss.xml" title="FPGA Multi-Agent FabrIc Architecture  RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/fpga_mafia_wiki/blog/atom.xml" title="FPGA Multi-Agent FabrIc Architecture  Atom Feed"><link rel="stylesheet" href="/fpga_mafia_wiki/assets/css/styles.7948e28b.css">
<link rel="preload" href="/fpga_mafia_wiki/assets/js/runtime~main.77d41840.js" as="script">
<link rel="preload" href="/fpga_mafia_wiki/assets/js/main.c1821f06.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/fpga_mafia_wiki/"><div class="navbar__logo"><img src="/fpga_mafia_wiki/img/BIU.png" alt="BIU logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/fpga_mafia_wiki/img/BIU.png" alt="BIU logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">FPGA MAFIA</b></a><a class="navbar__item navbar__link" href="/fpga_mafia_wiki/docs/fabric/intro">Fabric</a><a class="navbar__item navbar__link" href="/fpga_mafia_wiki/docs/rvc/intro">RISCV_Cores</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/fpga_mafia_wiki/docs/cache/cache_intro">Cache</a><a class="navbar__item navbar__link" href="/fpga_mafia_wiki/docs/IPs/IPs_intro">IPs</a><a class="navbar__item navbar__link" href="/fpga_mafia_wiki/docs/fpga/fpga_intro">FPGA</a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/fpga_mafia_wiki/docs/TFM/welcome">TFM</a><a class="navbar__item navbar__link" href="/fpga_mafia_wiki/docs/build_script/intro">MAFIA_Build</a><a href="https://github.com/amichai-bd/fpga_mafia" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub - Project<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://github.com/amichai-bd/fpga_mafia_wiki" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub - Wiki<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/fpga_mafia_wiki/docs/cache/cache_intro">Intro</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/fpga_mafia_wiki/docs/cache/HAS/HAS_intro">HAS</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/fpga_mafia_wiki/docs/cache/MAS/MAS_intro">MAS</a><button aria-label="Toggle the collapsible sidebar category &#x27;MAS&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/fpga_mafia_wiki/docs/cache/MAS/d_cache">Data Cache - MAS</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/fpga_mafia_wiki/docs/cache/MAS/pipe">Pipe</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/fpga_mafia_wiki/docs/cache/MAS/tag_data_arrays">tag_data_arrays</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/fpga_mafia_wiki/docs/cache/MAS/tq_entry">tq_entry</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/fpga_mafia_wiki/docs/cache/MAS/tq">tq</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/fpga_mafia_wiki/docs/cache/Verif/verif_intro">Verification</a><button aria-label="Toggle the collapsible sidebar category &#x27;Verification&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/fpga_mafia_wiki/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/fpga_mafia_wiki/docs/cache/MAS/MAS_intro"><span itemprop="name">MAS</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">tq_entry</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>tq_entry</h1><p>The transaction queue entry Micro-Architecture-Specification</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="block-diagram">Block Diagram<a href="#block-diagram" class="hash-link" aria-label="Direct link to Block Diagram" title="Direct link to Block Diagram">​</a></h2><p>TODO - insert the block diagram</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="top-level-interface">Top level interface<a href="#top-level-interface" class="hash-link" aria-label="Direct link to Top level interface" title="Direct link to Top level interface">​</a></h2><table><thead><tr><th>Name</th><th>Size</th><th>Direction</th><th>Description</th></tr></thead><tbody><tr><td>clk</td><td>1 bit</td><td>In</td><td>Clock signal for synchronous operation</td></tr><tr><td>rst</td><td>1 bit</td><td>In</td><td>Reset signal for resetting the module</td></tr><tr><td>entry_id</td><td>3 bits</td><td>In</td><td>Entry identifier for this module</td></tr><tr><td>core2cache_req</td><td>60 bits</td><td>In</td><td>Core-to-cache request data</td></tr><tr><td>allocate_entry</td><td>1 bit</td><td>In</td><td>Signal to allocate an entry</td></tr><tr><td>fm2cache_rd_rsp</td><td>149 bits</td><td>In</td><td>FM-to-cache read response data</td></tr><tr><td>pipe_lu_rsp_q3</td><td>164 bits</td><td>In</td><td>Pipe lookup response data</td></tr><tr><td>first_fill</td><td>1 bit</td><td>In</td><td>Signal indicating the first fill</td></tr><tr><td>cancel_core_req</td><td>1 bit</td><td>In</td><td>Signal to cancel the core request</td></tr><tr><td>tq_entry</td><td>162 bits</td><td>Out</td><td>TQ entry data output</td></tr><tr><td>next_tq_entry</td><td>162 bits</td><td>Out</td><td>Next TQ entry data output</td></tr><tr><td>rd_req_hit_mb</td><td>1 bit</td><td>Out</td><td>Signal indicating a read request hit</td></tr><tr><td>wr_req_hit_mb</td><td>1 bit</td><td>Out</td><td>Signal indicating a write request hit</td></tr><tr><td>free_entry</td><td>1 bit</td><td>Out</td><td>Signal indicating a free entry</td></tr><tr><td>fill_entry</td><td>1 bit</td><td>Out</td><td>Signal indicating a fill entry</td></tr></tbody></table><h2 class="anchor anchorWithStickyNavbar_LWe7" id="main-components">Main components:<a href="#main-components" class="hash-link" aria-label="Direct link to Main components:" title="Direct link to Main components:">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="tq-entry-flops">TQ entry Flops:<a href="#tq-entry-flops" class="hash-link" aria-label="Direct link to TQ entry Flops:" title="Direct link to TQ entry Flops:">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="motivation">Motivation:<a href="#motivation" class="hash-link" aria-label="Direct link to Motivation:" title="Direct link to Motivation:">​</a></h4><p>In the design of our cache architecture, the &#x27;tq entry&#x27; plays a crucial role in managing the interactions between the core processor and the cache subsystem. It serves as the entry point for incoming requests, tracks the state of each request, and handles data merging and storage. To provide a comprehensive understanding of its operation, we present a detailed analysis of the flip-flops used within the &#x27;tq entry&#x27; module. These flip-flops control various aspects of the entry&#x27;s behavior, such as request indications, merge buffer management, and address tracking. By documenting and analyzing these flip-flops, we aim to shed light on the inner workings of this essential component, facilitating both comprehension and potential enhancements to our cache architecture.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="table-of-flops">Table of Flops:<a href="#table-of-flops" class="hash-link" aria-label="Direct link to Table of Flops:" title="Direct link to Table of Flops:">​</a></h4><table><thead><tr><th>Name</th><th>Size</th><th>Description</th><th>when &amp; how data writes</th><th>who consumes the data</th></tr></thead><tbody><tr><td>state</td><td>3  bits</td><td>State of the TQ Entry</td><td>State transition</td><td></td></tr><tr><td>merge_buffer_e_modified</td><td>4  bits</td><td>Indication of merge Buffer modification</td><td>Bit is set when data in MB is modified</td><td></td></tr><tr><td>rd_indication</td><td>1  bits</td><td>Read indication</td><td>Bit is set when read request is processed</td><td></td></tr><tr><td>wr_indication</td><td>1  bits</td><td>Write indication</td><td>Bit is set when write request is processed</td><td></td></tr><tr><td>merge_buffer_data</td><td>128 bits</td><td>Data stored in the merge buffer</td><td>When merge buffer data is updated</td><td></td></tr><tr><td>cl_address</td><td>16 bits</td><td>Cache Line Adress</td><td>When cache line address is set</td><td></td></tr><tr><td>cl_word_offset</td><td>2  bits</td><td>Word offset within a Cache Line</td><td>When word offset is set</td><td></td></tr><tr><td>reg_id</td><td>6  bits</td><td>Register identifier</td><td>When register identifier is set</td><td></td></tr></tbody></table><h3 class="anchor anchorWithStickyNavbar_LWe7" id="tq-entry-fsm">TQ entry FSM:<a href="#tq-entry-fsm" class="hash-link" aria-label="Direct link to TQ entry FSM:" title="Direct link to TQ entry FSM:">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="motivation-1">Motivation:<a href="#motivation-1" class="hash-link" aria-label="Direct link to Motivation:" title="Direct link to Motivation:">​</a></h4><p>In the heart of our cache architecture lies the TQ (Transaction Queue) entry Finite State Machine (FSM). This FSM orchestrates the intricate dance between core processor requests, cache hits and misses, data merging, and state transitions within each TQ entry. Understanding the TQ entry FSM is paramount for comprehending the inner workings of our cache system. This section provides a comprehensive overview of the TQ entry FSM, shedding light on the transitions, conditions, and actions that shape the behavior of each entry.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="table-of-fsm-states">Table of FSM states:<a href="#table-of-fsm-states" class="hash-link" aria-label="Direct link to Table of FSM states:" title="Direct link to Table of FSM states:">​</a></h4><table><thead><tr><th>Name</th><th>Possible Next State</th><th>Description</th></tr></thead><tbody><tr><td>S_IDLE</td><td>S_LU_CORE</td><td>Waiting for a core request to allocate the entry</td></tr><tr><td>S_LU_CORE</td><td>S_IDLE / S_MB_WAIT_FILL</td><td>Core requests are being processed, and interactions with LU pipe may occur</td></tr><tr><td>S_MB_WAIT_FILL</td><td>S_MB_FILL_READY</td><td>The module is waiting for a cache fill response.</td></tr><tr><td>S_MB_FILL_READY</td><td>S_IDLE</td><td>The module is ready to send a cache fill response to the LU pipe</td></tr><tr><td>S_ERROR</td><td></td><td>Indicates an unexpected or erroneous situation</td></tr></tbody></table><h4 class="anchor anchorWithStickyNavbar_LWe7" id="diagram-of-the-tq-entry-fsm">Diagram of the TQ entry FSM:<a href="#diagram-of-the-tq-entry-fsm" class="hash-link" aria-label="Direct link to Diagram of the TQ entry FSM:" title="Direct link to Diagram of the TQ entry FSM:">​</a></h4><p><img loading="lazy" alt="TQ entry FSM" src="/fpga_mafia_wiki/assets/images/tq_entry_fsm-720e0aec0add346514196761de62bc2e.jpg" width="787" height="634" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="typical-fsm-flow">Typical FSM flow:<a href="#typical-fsm-flow" class="hash-link" aria-label="Direct link to Typical FSM flow:" title="Direct link to Typical FSM flow:">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="write-hit">Write Hit:<a href="#write-hit" class="hash-link" aria-label="Direct link to Write Hit:" title="Direct link to Write Hit:">​</a></h3><p>S_IDLE -&gt; S_LU_CORE -&gt; S_IDLE</p><ul><li><p>New write request from the core</p></li><li><p>TQ entry is allocated in parallel to the pipe lookup</p></li><li><p>TQ entry merge buffer is updated speculatively with the new request data</p></li><li><p>Lookup response is received as a hit - the TQ data is discarded. Entry returns to S_IDLE</p><p>(There is a case of B2B writes where the TQ state will not return to S_IDLE until the &quot;last write&quot; to the same CL responds from lookup. See Merge Buffer Behavior for more details.)</p></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="write-miss">Write Miss:<a href="#write-miss" class="hash-link" aria-label="Direct link to Write Miss:" title="Direct link to Write Miss:">​</a></h3><p>S<em>IDLE -&gt; S_LU_CORE-&gt;S_MB_WAIT_FILL -&gt; S_MB_FILL_READY -&gt; S</em> IDLE </p><ul><li>New write request from the core  </li><li>TQ entry is allocated in parallel to the pipe lookup  </li><li>TQ entry merge buffer is updated speculatively with the new request data.  </li><li>Lookup response is received as miss - moving to the MB_WAIT_FILL state.  </li><li>Far memory response is received, Merge buffer updates the write with the fill data,moving to the MB_FILL_READY state.  </li><li>The TQ entry wins the arbitration to send the &quot;Fill&quot; to the lookup pipe -&gt; movingto the S_IDLE state.<br>Note: We have a guaranty that the fill lookup will always win cache allocation. Meaning there is no &quot;miss&quot; for a fill request. this allows us to move to the S_IDLE state without waiting for the lookup response.</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="read-hit">Read Hit:<a href="#read-hit" class="hash-link" aria-label="Direct link to Read Hit:" title="Direct link to Read Hit:">​</a></h3><p>S<em>IDLE -&gt; S_LU_CORE-&gt;S</em> IDLE </p><ul><li>New read request from the core  </li><li>TQ entry is allocated in parallel to the pipe lookup  </li><li>TQ entry merge buffer is updated speculatively with the new request data  </li><li>Lookup response is received as hit - the TQ data is discarded. Entry returns to S_IDLE  </li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="read-miss">Read Miss:<a href="#read-miss" class="hash-link" aria-label="Direct link to Read Miss:" title="Direct link to Read Miss:">​</a></h3><p>S<em>IDLE -&gt; S_LU_CORE-&gt;S_MB_WAIT_FILL -&gt; S_MB_FILL_READY -&gt; S</em> IDLE  </p><ul><li>New read request from the core  </li><li>TQ entry is allocated in parallel to the pipe lookup  </li><li>There is no Data updated to the TQ entry merge buffer (this is a read request)  </li><li>Lookup response is received as miss - moving to the MB_WAIT_FILL state.  </li><li>Far memory response is received, Merge buffer updates the write with the fill data, moving to the MB_FILL_READY state.</li><li>The TQ entry wins the arbitration to send the &quot;Fill&quot; to the lookup pipe -&gt; moving to the S_IDLE state.<br>Note: We have a guaranty that the fill lookup will always win cache allocation.<br>Meaning there is no &quot;miss&quot; for a fill request.<br>this allows us to move to the S_IDLE state without waiting for the lookup response.</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="tq-entry-merge_buffer">TQ entry merge_buffer:<a href="#tq-entry-merge_buffer" class="hash-link" aria-label="Direct link to TQ entry merge_buffer:" title="Direct link to TQ entry merge_buffer:">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="motivation-2">Motivation:<a href="#motivation-2" class="hash-link" aria-label="Direct link to Motivation:" title="Direct link to Motivation:">​</a></h4><p>The merge_buffer is a buffer in our TQ that will store partial data during the time we are waiting for the Cache Line Data to be filled by the Far Memory.
Every entry in the TQ is linked to a Merge Buffer entry then we need to take care that every request to the same Cache-Line will never allocate a new entry if there already is an entry in the TQ for that specific Cache-Line.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="examples">Examples:<a href="#examples" class="hash-link" aria-label="Direct link to Examples:" title="Direct link to Examples:">​</a></h4><ul><li><p><strong>Write after Write</strong></p><ul><li><p>If the first write hits:</p><ul><li>The merge buffer will be discarded due to all the data is already updates in the cache.</li><li>The TQ entry will not go back to the S_IDLE state as long there are write request to that same CL in the lookup Pipe.<br>This is achieved by having a &quot;req_match_in_pipe&quot; indication in the lookup response struct.</li></ul></li><li><p>If the first write misses:</p><ul><li>The merge buffer will be merge with the second write data.</li><li>The first write will respond with a &quot;miss&quot; which will cause the TQ entry to go to the MB_WAIT_FILL state.</li><li>Any new write to that same CL will be merged with the merge buffer data.</li><li>Once the Far memory response is received, the merge buffer will be updated with the fill data.</li><li>The TQ entry will win the arbitration to send the &quot;Fill&quot; to the lookup pipe -&gt; moving to the S_IDLE state. </li></ul></li></ul></li><li><p><strong>Read after Write</strong></p><ul><li>If the first write request hits:<ul><li>The merge buffer will be discarded due to all the data is already updates in the cache.</li><li>The TQ entry will not go back to the S_IDLE state as long there are request to that same CL in the lookup Pipe.<br>This is achieved by having a &quot;req_match_in_pipe&quot; indication in the lookup response struct.</li></ul></li></ul></li></ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/FPGA-MAFIA/fpga_mafia_wiki/tree/main/docs/cache/MAS/tq_entry.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/fpga_mafia_wiki/docs/cache/MAS/tag_data_arrays"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">tag_data_arrays</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/fpga_mafia_wiki/docs/cache/MAS/tq"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">tq</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#block-diagram" class="table-of-contents__link toc-highlight">Block Diagram</a></li><li><a href="#top-level-interface" class="table-of-contents__link toc-highlight">Top level interface</a></li><li><a href="#main-components" class="table-of-contents__link toc-highlight">Main components:</a><ul><li><a href="#tq-entry-flops" class="table-of-contents__link toc-highlight">TQ entry Flops:</a></li><li><a href="#tq-entry-fsm" class="table-of-contents__link toc-highlight">TQ entry FSM:</a></li></ul></li><li><a href="#typical-fsm-flow" class="table-of-contents__link toc-highlight">Typical FSM flow:</a><ul><li><a href="#write-hit" class="table-of-contents__link toc-highlight">Write Hit:</a></li><li><a href="#write-miss" class="table-of-contents__link toc-highlight">Write Miss:</a></li><li><a href="#read-hit" class="table-of-contents__link toc-highlight">Read Hit:</a></li><li><a href="#read-miss" class="table-of-contents__link toc-highlight">Read Miss:</a></li><li><a href="#tq-entry-merge_buffer" class="table-of-contents__link toc-highlight">TQ entry merge_buffer:</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Contributors</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.linkedin.com/in/amichai-ben-david" target="_blank" rel="noopener noreferrer" class="footer__link-item">Amichai Ben-David</a></li><li class="footer__item"><a href="https://www.linkedin.com/in/noam-sabban" target="_blank" rel="noopener noreferrer" class="footer__link-item">Noam Sabban</a></li><li class="footer__item"><a href="https://github.com/ShmuelSfez" target="_blank" rel="noopener noreferrer" class="footer__link-item">Shmuel Sfez</a></li><li class="footer__item"><a href="https://github.com/yeonatanPerelman" target="_blank" rel="noopener noreferrer" class="footer__link-item">Yeonatan Perelman</a></li><li class="footer__item"><a href="https://github.com/danielk532" target="_blank" rel="noopener noreferrer" class="footer__link-item">Daniel Kaufman</a></li><li class="footer__item"><a href="https://www.linkedin.com/in/roman-gilgor-a5326532/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Roman Gilgor</a></li></ul></div><div class="col footer__col"><div class="footer__title">RTL Units</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/fpga_mafia_wiki/docs/fabric/intro">Fabric</a></li><li class="footer__item"><a class="footer__link-item" href="/fpga_mafia_wiki/docs/fabric/intro">- Tile</a></li><li class="footer__item"><a class="footer__link-item" href="/fpga_mafia_wiki/docs/fabric/intro">- Router</a></li><li class="footer__item"><a class="footer__link-item" href="/fpga_mafia_wiki/docs/rvc/intro">RISCV Cores</a></li><li class="footer__item"><a class="footer__link-item" href="/fpga_mafia_wiki/docs/cache/cache_intro">Memory Subsystem</a></li><li class="footer__item"><a class="footer__link-item" href="/fpga_mafia_wiki/docs/cache/cache_intro">- Instruction Cache</a></li><li class="footer__item"><a class="footer__link-item" href="/fpga_mafia_wiki/docs/cache/cache_intro">- Data Cache</a></li><li class="footer__item"><a class="footer__link-item" href="/fpga_mafia_wiki/docs/cache/cache_intro">- Memory Controller</a></li></ul></div><div class="col footer__col"><div class="footer__title">TFM</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/fpga_mafia_wiki/docs/TFM/projectTool/intro">Project Tool</a></li><li class="footer__item"><a class="footer__link-item" href="/fpga_mafia_wiki/docs/TFM/projectTool/git_and_github">- Git &amp; GitHub</a></li><li class="footer__item"><a class="footer__link-item" href="/fpga_mafia_wiki/docs/TFM/projectTool/GccRiscV">- RISCV GCC</a></li><li class="footer__item"><a class="footer__link-item" href="/fpga_mafia_wiki/docs/TFM/projectTool/ModelSim">- Modelsim</a></li><li class="footer__item"><a class="footer__link-item" href="/fpga_mafia_wiki/docs/TFM/projectTool/ModelSim">- Quartus</a></li><li class="footer__item"><a class="footer__link-item" href="/fpga_mafia_wiki/docs/TFM/verilog/intro">System-Verilog</a></li></ul></div><div class="col footer__col"><div class="footer__title">GitHub - links</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/amichai-bd/fpga_mafia" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub - FPGA MAFIA<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/amichai-bd/fpga_mafia_wiki" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub - FPGA MAFIA WIKI<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 MAFIA Project</div></div></div></footer></div>
<script src="/fpga_mafia_wiki/assets/js/runtime~main.77d41840.js"></script>
<script src="/fpga_mafia_wiki/assets/js/main.c1821f06.js"></script>
</body>
</html>