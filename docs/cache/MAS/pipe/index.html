<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-cache/MAS/pipe" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.3">
<title data-rh="true">Pipe | FPGA Multi-Agent FabrIc Architecture </title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://fpga-mafia.github.io /fpga_mafia_wiki/docs/cache/MAS/pipe"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Pipe | FPGA Multi-Agent FabrIc Architecture "><meta data-rh="true" name="description" content="This module represents the data cache pipeline that efficiently handles cache operations, data hazards, tag comparisons, cache misses and communicates with other components. The pipeline consists of several stages, each responsible for specific tasks."><meta data-rh="true" property="og:description" content="This module represents the data cache pipeline that efficiently handles cache operations, data hazards, tag comparisons, cache misses and communicates with other components. The pipeline consists of several stages, each responsible for specific tasks."><link data-rh="true" rel="icon" href="/fpga_mafia_wiki/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://fpga-mafia.github.io /fpga_mafia_wiki/docs/cache/MAS/pipe"><link data-rh="true" rel="alternate" href="https://fpga-mafia.github.io /fpga_mafia_wiki/docs/cache/MAS/pipe" hreflang="en"><link data-rh="true" rel="alternate" href="https://fpga-mafia.github.io /fpga_mafia_wiki/docs/cache/MAS/pipe" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/fpga_mafia_wiki/blog/rss.xml" title="FPGA Multi-Agent FabrIc Architecture  RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/fpga_mafia_wiki/blog/atom.xml" title="FPGA Multi-Agent FabrIc Architecture  Atom Feed"><link rel="stylesheet" href="/fpga_mafia_wiki/assets/css/styles.7948e28b.css">
<link rel="preload" href="/fpga_mafia_wiki/assets/js/runtime~main.3d6f4275.js" as="script">
<link rel="preload" href="/fpga_mafia_wiki/assets/js/main.c1821f06.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/fpga_mafia_wiki/"><div class="navbar__logo"><img src="/fpga_mafia_wiki/img/BIU.png" alt="BIU logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/fpga_mafia_wiki/img/BIU.png" alt="BIU logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">FPGA MAFIA</b></a><a class="navbar__item navbar__link" href="/fpga_mafia_wiki/docs/fabric/intro">Fabric</a><a class="navbar__item navbar__link" href="/fpga_mafia_wiki/docs/rvc/intro">RISCV_Cores</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/fpga_mafia_wiki/docs/cache/cache_intro">Cache</a><a class="navbar__item navbar__link" href="/fpga_mafia_wiki/docs/IPs/IPs_intro">IPs</a><a class="navbar__item navbar__link" href="/fpga_mafia_wiki/docs/fpga/fpga_intro">FPGA</a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/fpga_mafia_wiki/docs/TFM/welcome">TFM</a><a class="navbar__item navbar__link" href="/fpga_mafia_wiki/docs/build_script/intro">MAFIA_Build</a><a href="https://github.com/amichai-bd/fpga_mafia" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub - Project<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://github.com/amichai-bd/fpga_mafia_wiki" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub - Wiki<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/fpga_mafia_wiki/docs/cache/cache_intro">Intro</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/fpga_mafia_wiki/docs/cache/HAS/HAS_intro">HAS</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/fpga_mafia_wiki/docs/cache/MAS/MAS_intro">MAS</a><button aria-label="Toggle the collapsible sidebar category &#x27;MAS&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/fpga_mafia_wiki/docs/cache/MAS/d_cache">Data Cache - MAS</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/fpga_mafia_wiki/docs/cache/MAS/pipe">Pipe</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/fpga_mafia_wiki/docs/cache/MAS/tag_data_arrays">tag_data_arrays</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/fpga_mafia_wiki/docs/cache/MAS/tq_entry">tq_entry</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/fpga_mafia_wiki/docs/cache/MAS/tq">tq</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/fpga_mafia_wiki/docs/cache/Verif/verif_intro">Verification</a><button aria-label="Toggle the collapsible sidebar category &#x27;Verification&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/fpga_mafia_wiki/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/fpga_mafia_wiki/docs/cache/MAS/MAS_intro"><span itemprop="name">MAS</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Pipe</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Pipe</h1><p>This module represents the data cache pipeline that efficiently handles cache operations, data hazards, tag comparisons, cache misses and communicates with other components. The pipeline consists of several stages, each responsible for specific tasks.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="the-pipe-stages">The pipe Stages<a href="#the-pipe-stages" class="hash-link" aria-label="Direct link to The pipe Stages" title="Direct link to The pipe Stages">​</a></h3><ul><li>Q1 - Set Lookup / Tag Array Lookup</li><li>Q2 - Data Hazard Resolution, Tag Comparison, Allocation of Victim</li><li>Q3 - Update of Tag Array, Data Fetch, Cache Miss Handling</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="pipe-block-diagram">Pipe Block Diagram<a href="#pipe-block-diagram" class="hash-link" aria-label="Direct link to Pipe Block Diagram" title="Direct link to Pipe Block Diagram">​</a></h2><p>TODO: Add block diagram</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="io">IO<a href="#io" class="hash-link" aria-label="Direct link to IO" title="Direct link to IO">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="general-io">General IO<a href="#general-io" class="hash-link" aria-label="Direct link to General IO" title="Direct link to General IO">​</a></h3><table><thead><tr><th>Signal Name</th><th>Direction</th><th>Size</th><th>Description</th></tr></thead><tbody><tr><td>clk</td><td>Input</td><td>1 bit</td><td>Clock signal.</td></tr><tr><td>rst</td><td>Input</td><td>1 bit</td><td>Reset signal.</td></tr></tbody></table><h3 class="anchor anchorWithStickyNavbar_LWe7" id="pipe-tq-io">pipe&lt;-&gt;tq IO<a href="#pipe-tq-io" class="hash-link" aria-label="Direct link to pipe&lt;-&gt;tq IO" title="Direct link to pipe&lt;-&gt;tq IO">​</a></h3><table><thead><tr><th>Signal Name</th><th>Direction</th><th>Size</th><th>Description</th></tr></thead><tbody><tr><td>pipe_lu_req_q1</td><td>Input</td><td>195 bits</td><td>Input request to the cache pipeline.</td></tr><tr><td>pipe_lu_req_q1.valid</td><td>Input</td><td>1 bit</td><td>Valid bit for the input request.</td></tr><tr><td>pipe_lu_req_q1.reg_id</td><td>Input</td><td>5 bits</td><td>Register ID of the input request.</td></tr><tr><td>pipe_lu_req_q1.addr</td><td>Input</td><td>64 bits</td><td>Address of the input request.</td></tr><tr><td>pipe_lu_req_q1.lu_op</td><td>Input</td><td>2 bits</td><td>Lookup operation of the input request.</td></tr><tr><td>pipe_lu_req_q1.cl_data</td><td>Input</td><td>128 bits</td><td>Cache line data of the input request.</td></tr><tr><td>pipe_early_lu_rsp_q2</td><td>Output</td><td>13 bits</td><td>Early response from the cache pipeline.</td></tr><tr><td>pipe_lu_rsp_q3</td><td>Output</td><td>164 bits</td><td>Final response from the cache pipeline.</td></tr><tr><td>cache2fm_req_q3</td><td>Output</td><td>154 bits</td><td>Request sent to the FM (Far Memory) interface.</td></tr></tbody></table><h3 class="anchor anchorWithStickyNavbar_LWe7" id="pipe-tag_array-io">pipe&lt;-&gt;tag_array IO<a href="#pipe-tag_array-io" class="hash-link" aria-label="Direct link to pipe&lt;-&gt;tag_array IO" title="Direct link to pipe&lt;-&gt;tag_array IO">​</a></h3><table><thead><tr><th>Signal Name</th><th>Direction</th><th>Size</th><th>Description</th></tr></thead><tbody><tr><td>rd_set_req_q1</td><td>Output</td><td>9 bits</td><td>Read request to the tag array.</td></tr><tr><td>wr_data_set_q2</td><td>Output</td><td>41 bits</td><td>Write request to the tag array.</td></tr><tr><td>pre_rd_data_set_rsp_q2</td><td>Input</td><td>44 bits</td><td>Previous read data response from the tag array.</td></tr></tbody></table><h3 class="anchor anchorWithStickyNavbar_LWe7" id="pipe-data_array-io">pipe&lt;-&gt;data_array IO<a href="#pipe-data_array-io" class="hash-link" aria-label="Direct link to pipe&lt;-&gt;data_array IO" title="Direct link to pipe&lt;-&gt;data_array IO">​</a></h3><table><thead><tr><th>Signal Name</th><th>Direction</th><th>Size</th><th>Description</th></tr></thead><tbody><tr><td>rd_cl_req_q2</td><td>Output</td><td>10 bits</td><td>Read request to the data array.</td></tr><tr><td>wr_data_cl_q3</td><td>Output</td><td>139 bits</td><td>Write request to the data array.</td></tr><tr><td>pre_rd_data_cl_rsp_q3</td><td>Input</td><td>128 bit ss</td><td>Previous read data response from the data array.</td></tr></tbody></table><h2 class="anchor anchorWithStickyNavbar_LWe7" id="strategy">Strategy<a href="#strategy" class="hash-link" aria-label="Direct link to Strategy" title="Direct link to Strategy">​</a></h2><p>We created a struct that represents the cache pipeline.<br>
<!-- -->In every pipe stage, we can access the struct to get the relevant information for the current stage + update the struct with the relevant information that was calculated in the current stage.</p><h5 class="anchor anchorWithStickyNavbar_LWe7" id="the-struct-contains-the-following-fields">The struct contains the following fields:<a href="#the-struct-contains-the-following-fields" class="hash-link" aria-label="Direct link to The struct contains the following fields:" title="Direct link to The struct contains the following fields:">​</a></h5><table><thead><tr><th>Field Name</th><th>Size</th><th>Description</th></tr></thead><tbody><tr><td>lu_valid</td><td>1  bit</td><td>Indicates if the lookup (LU) operation is valid.</td></tr><tr><td>lu_offset</td><td>4  bits</td><td>Offset within the cache line (from <code>t_offset</code>).</td></tr><tr><td>lu_set</td><td>8  bits</td><td>Set index within the cache (from <code>t_set_address</code>).</td></tr><tr><td>lu_tag</td><td>8  bits</td><td>Tag associated with the cache line (from <code>t_tag</code>).</td></tr><tr><td>lu_op</td><td>2  bits</td><td>Specifies the LU operation type (from <code>t_lu_opcode</code>).</td></tr><tr><td>lu_tq_id</td><td>3  bits</td><td>Transaction Queue (TQ) ID associated with the operation (from <code>t_tq_id</code>).</td></tr><tr><td>hit</td><td>1  bit</td><td>Indicates if the LU operation resulted in a cache hit.</td></tr><tr><td>miss</td><td>1  bit</td><td>Indicates if the LU operation resulted in a cache miss.</td></tr><tr><td>mb_hit_cancel</td><td>1  bit</td><td>Indicates whether there&#x27;s a MultiBank (MB) hit cancellation.</td></tr><tr><td>set_ways_valid</td><td>4  bits</td><td>Valid bit for each cache way in the specified set.</td></tr><tr><td>set_ways_modified</td><td>4  bits</td><td>Modified bit for each cache way in the specified set.</td></tr><tr><td>set_ways_mru</td><td>4  bits</td><td>Most Recently Used (MRU) bit for each cache way in the specified set.</td></tr><tr><td>set_ways_tags</td><td>32  bits</td><td>Tags for each cache way in the specified set.</td></tr><tr><td>set_ways_victim</td><td>4  bits</td><td>Victim way selection in the specified set.</td></tr><tr><td>set_ways_hit</td><td>4  bits</td><td>Indicates if there&#x27;s a hit for each cache way in the specified set.</td></tr><tr><td>set_ways_enc_hit</td><td>2  bits</td><td>Encoded hit information for the ways in the specified set.</td></tr><tr><td>cl_data</td><td>128 bits</td><td>Cache line data (from <code>t_cl</code>).</td></tr><tr><td>data</td><td>32 bits</td><td>Data associated with the LU operation.</td></tr><tr><td>fill_modified</td><td>1 bit</td><td>Indicates if the cache line is modified during a fill operation.</td></tr><tr><td>fill_rd</td><td>1 bit</td><td>Indicates if the fill operation is a read operation.</td></tr><tr><td>reg_id</td><td>5 bits</td><td>Register ID associated with the operation (from <code>t_reg_id</code>).</td></tr><tr><td>dirty_evict</td><td>1 bit</td><td>Indicates if a dirty eviction is requested.</td></tr><tr><td>data_array_address</td><td>10 bits</td><td>Address within the cache data array.</td></tr><tr><td>rd_indication</td><td>1 bit</td><td>Indicates if this operation is a read indication.</td></tr></tbody></table><h2 class="anchor anchorWithStickyNavbar_LWe7" id="pipe-stages">Pipe Stages<a href="#pipe-stages" class="hash-link" aria-label="Direct link to Pipe Stages" title="Direct link to Pipe Stages">​</a></h2><p>The “Pipe” is a 3-stage pipeline that manages the tag array lookup (LU) &amp; Cache access.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="q1---set-lookup--tag-array-lookup">Q1 - Set Lookup / Tag Array Lookup<a href="#q1---set-lookup--tag-array-lookup" class="hash-link" aria-label="Direct link to Q1 - Set Lookup / Tag Array Lookup" title="Direct link to Q1 - Set Lookup / Tag Array Lookup">​</a></h3><p>In this stage, the module performs a set lookup and tag array lookup. It prepares the cache request by extracting relevant information from the input request.
Features and Actions:</p><ul><li>Extracts the set index from the input address.</li><li>Prepares the cache request by populating various fields.</li><li>Assigns signals to the tag array lookup request.</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="q2---data-hazard-resolution-tag-comparison-allocation-of-victim">Q2 - Data Hazard Resolution, Tag Comparison, Allocation of Victim<a href="#q2---data-hazard-resolution-tag-comparison-allocation-of-victim" class="hash-link" aria-label="Direct link to Q2 - Data Hazard Resolution, Tag Comparison, Allocation of Victim" title="Direct link to Q2 - Data Hazard Resolution, Tag Comparison, Allocation of Victim">​</a></h3><p>Stage Q2 is critical for hazard resolution, tag comparison, and determining the victim for cache allocation.
Updating the tag array.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="hazard-resolution">Hazard Resolution<a href="#hazard-resolution" class="hash-link" aria-label="Direct link to Hazard Resolution" title="Direct link to Hazard Resolution">​</a></h4><p>In the case of valid access b2b to the same set, we need to forward a sampled version (Q3) of te previous tag array write, to be used as override of the read response from tag array.
This is due to the fact that the tag array write is not yet visible to the tag array read which took place in Q1.</p><p>TODO - insert a diagram of the hazard resolution</p><ul><li>Detects data hazards by checking if Q2 and Q3 access the same set.
ths is important due to the data being written to the  in Q3</li><li>Resolves data hazards by forwarding the data from Q3 to Q2.</li></ul><div class="language-systemverilog codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-systemverilog codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">assign hazard_detected_q2 = (cache_pipe_lu_q2.lu_set == cache_pipe_lu_q3.lu_set) &amp;&amp; cache_pipe_lu_q3.lu_valid &amp;&amp; cache_pipe_lu_q2.lu_valid;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">assign rd_data_set_rsp_q2 = hazard_detected_q2 ? hazard_rd_data_set_rsp_q3 : pre_rd_data_set_rsp_q2;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="tag-comparison-and-victim-allocation">Tag Comparison and Victim Allocation<a href="#tag-comparison-and-victim-allocation" class="hash-link" aria-label="Direct link to Tag Comparison and Victim Allocation" title="Direct link to Tag Comparison and Victim Allocation">​</a></h4><p>After we have the &quot;final&quot; result of the tag lookup, we compares tags to identify if cache hits &amp; which way.</p><div class="language-systemverilog codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-systemverilog codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">always_comb begin</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    for( int WAY =0; WAY&lt;NUM_WAYS; WAY++) begin</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        way_tag_match_q2[WAY] = (rd_data_set_rsp_q2.tags[WAY] == cache_pipe_lu_q2.lu_tag)  &amp;&amp; </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                 rd_data_set_rsp_q2.valid[WAY] &amp;&amp;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                 cache_pipe_lu_q2.lu_valid ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    end</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">end</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="choose-victim-in-case-of-cache-fills">choose victim in case of cache fills.<a href="#choose-victim-in-case-of-cache-fills" class="hash-link" aria-label="Direct link to choose victim in case of cache fills." title="Direct link to choose victim in case of cache fills.">​</a></h4><p>In case of a fill, we need to allocate a victim.
We prioritize &quot;free&quot; ways.
When all ways are occupied, we use a bit-flip pseudo MRU (Most Recently Used) policy to allocate a victim.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="update-tag-array">Update tag array<a href="#update-tag-array" class="hash-link" aria-label="Direct link to Update tag array" title="Direct link to Update tag array">​</a></h3><p>In this stage, the module updates the tag array. The update process depends on different scenarios:</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="read-hit">Read hit<a href="#read-hit" class="hash-link" aria-label="Direct link to Read hit" title="Direct link to Read hit">​</a></h4><p>In the case of a read hit, the module updates the Most Recently Used information in the tag array. It ensures that the way that was just accessed becomes the MRU.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="write-hit">Write hit<a href="#write-hit" class="hash-link" aria-label="Direct link to Write hit" title="Direct link to Write hit">​</a></h4><p>When a write hits a cache line, the module updates both the MRU information and the &quot;modified&quot; status in the tag array. Additionally to the MRU, the modified bits are set for the way that was written to, indicating that its data has been modified.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="fill">Fill<a href="#fill" class="hash-link" aria-label="Direct link to Fill" title="Direct link to Fill">​</a></h4><p>In the case of a cache fill, we will have differents updates:</p><ul><li>The MRU is updated.</li><li>The valid status is set which indicate that it now contains valid data.</li><li>The tag information in the tag array is updated to match the tag of the incoming data.</li><li>If the fill operation includes modified data from the merge buffer, the modified status is set which indicate that it now holds modified data.</li></ul><h5 class="anchor anchorWithStickyNavbar_LWe7" id="all-are-mru---bit-flip-pseudo-mru-most-recently-used-policy">All are MRU - bit-flip pseudo MRU (Most Recently Used) policy<a href="#all-are-mru---bit-flip-pseudo-mru-most-recently-used-policy" class="hash-link" aria-label="Direct link to All are MRU - bit-flip pseudo MRU (Most Recently Used) policy" title="Direct link to All are MRU - bit-flip pseudo MRU (Most Recently Used) policy">​</a></h5><p>Link to the wiki pseudo MRU policy: <a href="https://en.wikipedia.org/wiki/Pseudo-LRU#Bit-PLRU" target="_blank" rel="noopener noreferrer">https://en.wikipedia.org/wiki/Pseudo-LRU#Bit-PLRU</a>
Bit-PLRU stores one status bit for each cache line. These bits are called MRU-bits. Every access to a line sets its MRU-bit to 1, indicating that the line was recently used. Whenever the last remaining 0 bit of a set&#x27;s status bits is set to 1, all other bits are reset to 0. At cache misses, the leftmost line whose MRU-bit is 0 is replaced.</p><div class="language-systemverilog codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-systemverilog codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">//-----------------------------</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">// if all are MRU - need to bit flip and set the new allocation/ last hit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">//-----------------------------</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">if(&amp;(set_ways_mru_q2)) begin        </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    set_ways_mru_q2 = cache_pipe_lu_q2.hit ? cache_pipe_lu_q2.set_ways_hit    : //reset all, and set only the WR/RD Hit location</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                             cache_pipe_lu_q2.set_ways_victim ; //reset all, and set only the WR/RD Hit location</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">end</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="data-fetch">Data fetch<a href="#data-fetch" class="hash-link" aria-label="Direct link to Data fetch" title="Direct link to Data fetch">​</a></h3><p>Now we determine if and where there was a cache hit, we can fetch the data from the data array.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="q3---update-of-tag-array-data-fetch-cache-miss-handling">Q3 - Update of Tag Array, Data Fetch, Cache Miss Handling<a href="#q3---update-of-tag-array-data-fetch-cache-miss-handling" class="hash-link" aria-label="Direct link to Q3 - Update of Tag Array, Data Fetch, Cache Miss Handling" title="Direct link to Q3 - Update of Tag Array, Data Fetch, Cache Miss Handling">​</a></h3><p>In the third stage, the module updates the tag array, fetches data from the data array, and handles cache misses.</p><p>Features and Actions:</p><ul><li>Updates the tag array based on cache operations (read, write, fill).</li><li>Fetches data from the data array.</li><li>Handles cache misses by sending fill requests to a far memory component.</li><li>Detects dirty eviction for modified cache lines and sends them to far memory.</li></ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/FPGA-MAFIA/fpga_mafia_wiki/tree/main/docs/cache/MAS/pipe.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/fpga_mafia_wiki/docs/cache/MAS/d_cache"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Data Cache - MAS</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/fpga_mafia_wiki/docs/cache/MAS/tag_data_arrays"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">tag_data_arrays</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#the-pipe-stages" class="table-of-contents__link toc-highlight">The pipe Stages</a></li><li><a href="#pipe-block-diagram" class="table-of-contents__link toc-highlight">Pipe Block Diagram</a></li><li><a href="#io" class="table-of-contents__link toc-highlight">IO</a><ul><li><a href="#general-io" class="table-of-contents__link toc-highlight">General IO</a></li><li><a href="#pipe-tq-io" class="table-of-contents__link toc-highlight">pipe&lt;-&gt;tq IO</a></li><li><a href="#pipe-tag_array-io" class="table-of-contents__link toc-highlight">pipe&lt;-&gt;tag_array IO</a></li><li><a href="#pipe-data_array-io" class="table-of-contents__link toc-highlight">pipe&lt;-&gt;data_array IO</a></li></ul></li><li><a href="#strategy" class="table-of-contents__link toc-highlight">Strategy</a></li><li><a href="#pipe-stages" class="table-of-contents__link toc-highlight">Pipe Stages</a><ul><li><a href="#q1---set-lookup--tag-array-lookup" class="table-of-contents__link toc-highlight">Q1 - Set Lookup / Tag Array Lookup</a></li><li><a href="#q2---data-hazard-resolution-tag-comparison-allocation-of-victim" class="table-of-contents__link toc-highlight">Q2 - Data Hazard Resolution, Tag Comparison, Allocation of Victim</a></li><li><a href="#update-tag-array" class="table-of-contents__link toc-highlight">Update tag array</a></li><li><a href="#data-fetch" class="table-of-contents__link toc-highlight">Data fetch</a></li><li><a href="#q3---update-of-tag-array-data-fetch-cache-miss-handling" class="table-of-contents__link toc-highlight">Q3 - Update of Tag Array, Data Fetch, Cache Miss Handling</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Contributors</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.linkedin.com/in/amichai-ben-david" target="_blank" rel="noopener noreferrer" class="footer__link-item">Amichai Ben-David</a></li><li class="footer__item"><a href="https://www.linkedin.com/in/noam-sabban" target="_blank" rel="noopener noreferrer" class="footer__link-item">Noam Sabban</a></li><li class="footer__item"><a href="https://github.com/ShmuelSfez" target="_blank" rel="noopener noreferrer" class="footer__link-item">Shmuel Sfez</a></li><li class="footer__item"><a href="https://github.com/yeonatanPerelman" target="_blank" rel="noopener noreferrer" class="footer__link-item">Yeonatan Perelman</a></li><li class="footer__item"><a href="https://github.com/danielk532" target="_blank" rel="noopener noreferrer" class="footer__link-item">Daniel Kaufman</a></li><li class="footer__item"><a href="https://www.linkedin.com/in/roman-gilgor-a5326532/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Roman Gilgor</a></li></ul></div><div class="col footer__col"><div class="footer__title">RTL Units</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/fpga_mafia_wiki/docs/fabric/intro">Fabric</a></li><li class="footer__item"><a class="footer__link-item" href="/fpga_mafia_wiki/docs/fabric/intro">- Tile</a></li><li class="footer__item"><a class="footer__link-item" href="/fpga_mafia_wiki/docs/fabric/intro">- Router</a></li><li class="footer__item"><a class="footer__link-item" href="/fpga_mafia_wiki/docs/rvc/intro">RISCV Cores</a></li><li class="footer__item"><a class="footer__link-item" href="/fpga_mafia_wiki/docs/cache/cache_intro">Memory Subsystem</a></li><li class="footer__item"><a class="footer__link-item" href="/fpga_mafia_wiki/docs/cache/cache_intro">- Instruction Cache</a></li><li class="footer__item"><a class="footer__link-item" href="/fpga_mafia_wiki/docs/cache/cache_intro">- Data Cache</a></li><li class="footer__item"><a class="footer__link-item" href="/fpga_mafia_wiki/docs/cache/cache_intro">- Memory Controller</a></li></ul></div><div class="col footer__col"><div class="footer__title">TFM</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/fpga_mafia_wiki/docs/TFM/projectTool/intro">Project Tool</a></li><li class="footer__item"><a class="footer__link-item" href="/fpga_mafia_wiki/docs/TFM/projectTool/git_and_github">- Git &amp; GitHub</a></li><li class="footer__item"><a class="footer__link-item" href="/fpga_mafia_wiki/docs/TFM/projectTool/GccRiscV">- RISCV GCC</a></li><li class="footer__item"><a class="footer__link-item" href="/fpga_mafia_wiki/docs/TFM/projectTool/ModelSim">- Modelsim</a></li><li class="footer__item"><a class="footer__link-item" href="/fpga_mafia_wiki/docs/TFM/projectTool/ModelSim">- Quartus</a></li><li class="footer__item"><a class="footer__link-item" href="/fpga_mafia_wiki/docs/TFM/verilog/intro">System-Verilog</a></li></ul></div><div class="col footer__col"><div class="footer__title">GitHub - links</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/amichai-bd/fpga_mafia" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub - FPGA MAFIA<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/amichai-bd/fpga_mafia_wiki" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub - FPGA MAFIA WIKI<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 MAFIA Project</div></div></div></footer></div>
<script src="/fpga_mafia_wiki/assets/js/runtime~main.3d6f4275.js"></script>
<script src="/fpga_mafia_wiki/assets/js/main.c1821f06.js"></script>
</body>
</html>